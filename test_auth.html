<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>数据可视化平台 · 登录注册</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "PingFang SC", "Microsoft YaHei", sans-serif;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top left, #3b82f6 0, #0f172a 40%, #020617 100%);
      color: #e5e7eb;
    }

    .container {
      width: 960px;
      max-width: 95vw;
      background: rgba(15, 23, 42, 0.92);
      border-radius: 18px;
      box-shadow: 0 22px 45px rgba(0, 0, 0, 0.45);
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.3);
      backdrop-filter: blur(18px);
    }

    /* 左侧介绍区 */
    .left {
      padding: 32px 32px 28px;
      border-right: 1px solid rgba(55, 65, 81, 0.7);
      background: radial-gradient(circle at top, rgba(59, 130, 246, 0.4), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(34, 197, 94, 0.22), transparent 55%);
      position: relative;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 28px;
    }

    .logo-icon {
      width: 34px;
      height: 34px;
      border-radius: 13px;
      background: conic-gradient(from 140deg, #38bdf8, #4ade80, #a855f7, #38bdf8);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #0f172a;
      font-weight: 800;
      font-size: 18px;
      box-shadow: 0 10px 25px rgba(56, 189, 248, 0.45);
    }

    .logo-text-main {
      font-weight: 600;
      letter-spacing: 0.03em;
    }

    .logo-text-sub {
      font-size: 12px;
      color: #9ca3af;
    }

    .title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .subtitle {
      font-size: 13px;
      color: #9ca3af;
      margin-bottom: 24px;
      line-height: 1.5;
    }

    .stats {
      display: flex;
      gap: 20px;
      margin-bottom: 24px;
    }

    .stat-card {
      flex: 1;
      background: rgba(15, 23, 42, 0.7);
      border-radius: 12px;
      padding: 10px 12px;
      border: 1px solid rgba(55, 65, 81, 0.9);
    }

    .stat-value {
      font-size: 18px;
      font-weight: 600;
    }

    .stat-label {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 4px;
    }

    .mini-chart {
      margin-top: 16px;
      height: 90px;
      border-radius: 12px;
      border: 1px dashed rgba(148, 163, 184, 0.6);
      padding: 10px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      font-size: 11px;
      color: #9ca3af;
    }

    .sparkline {
      flex: 1;
      display: flex;
      gap: 4px;
      align-items: flex-end;
    }

    .spark-bar {
      flex: 1;
      border-radius: 999px;
      background: linear-gradient(to top, #22c55e, #4ade80);
    }

    .spark-bar.dim {
      background: linear-gradient(to top, rgba(148, 163, 184, 0.8), rgba(156, 163, 175, 0.45));
    }

    .badge {
      position: absolute;
      right: 22px;
      bottom: 22px;
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: #9ca3af;
    }

    /* 右侧表单区 */
    .right {
      padding: 30px 26px 26px;
      background: radial-gradient(circle at top right, rgba(59, 130, 246, 0.3), transparent 55%);
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .tabs {
      display: flex;
      gap: 6px;
      margin-bottom: 8px;
      background: rgba(15, 23, 42, 0.85);
      padding: 4px;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.8);
    }

    .tab {
      flex: 1;
      border-radius: 999px;
      font-size: 13px;
      padding: 6px 0;
      text-align: center;
      cursor: pointer;
      border: none;
      background: transparent;
      color: #9ca3af;
      transition: all 0.18s ease;
    }

    .tab.active {
      background: linear-gradient(to right, #3b82f6, #22c55e);
      color: #0f172a;
      font-weight: 600;
      box-shadow: 0 10px 25px rgba(37, 99, 235, 0.4);
    }

    .form-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .form-desc {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 12px;
    }

    .form-group {
      margin-bottom: 10px;
    }

    .form-label {
      font-size: 12px;
      margin-bottom: 4px;
      color: #e5e7eb;
      display: block;
    }

    .input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 9px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      font-size: 13px;
      outline: none;
      transition: all 0.18s ease;
    }

    .input:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.5);
    }

    .input::placeholder {
      color: #6b7280;
    }

    .btn {
      width: 100%;
      margin-top: 4px;
      padding: 9px 0;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      background: linear-gradient(to right, #3b82f6, #22c55e);
      color: #0f172a;
      box-shadow: 0 12px 30px rgba(37, 99, 235, 0.5);
      transition: transform 0.12s ease, box-shadow 0.12s ease;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 35px rgba(37, 99, 235, 0.65);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: 0 10px 24px rgba(37, 99, 235, 0.5);
    }

    .meta-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 11px;
      color: #9ca3af;
      margin-top: 6px;
    }

    .meta-highlight {
      color: #a5b4fc;
      cursor: default;
    }

    .status {
      margin-top: 10px;
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 12px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(55, 65, 81, 0.9);
      max-height: 140px;
      overflow: auto;
      white-space: pre-wrap;
      color: #e5e7eb;
    }

    .status.empty {
      color: #6b7280;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 3px 8px;
      margin-top: 6px;
      color: #9ca3af;
    }

    .tag-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
    }

    .token-note {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 4px;
    }

    .token-note span {
      color: #a5b4fc;
    }

    @media (max-width: 780px) {
      .container {
        grid-template-columns: 1fr;
      }

      .left {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- 左侧介绍 -->
    <div class="left">
      <div class="logo">
        <div class="logo-icon">V</div>
        <div>
          <div class="logo-text-main">VizBoard</div>
          <div class="logo-text-sub">数据可视化平台 · Demo</div>
        </div>
      </div>

      <div class="title">一键登录，查看你的分析面板</div>
      <div class="subtitle">
        通过登录模块，我们可以对每个用户做独立的数据隔离与权限控制，<br />
        这只是 Demo，后面可以直接接到你真正的图表页面。
      </div>

      <div class="stats">
        <div class="stat-card">
          <div class="stat-value">1,280</div>
          <div class="stat-label">今日访问量（示例数据）</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">63%</div>
          <div class="stat-label">活跃用户占比（示例数据）</div>
        </div>
      </div>

      <div class="mini-chart">
        <div>最近 7 天访问趋势 · 示例</div>
        <div class="sparkline">
          <div class="spark-bar dim" style="height: 25%;"></div>
          <div class="spark-bar dim" style="height: 40%;"></div>
          <div class="spark-bar" style="height: 65%;"></div>
          <div class="spark-bar" style="height: 80%;"></div>
          <div class="spark-bar" style="height: 55%;"></div>
          <div class="spark-bar dim" style="height: 48%;"></div>
          <div class="spark-bar" style="height: 70%;"></div>
        </div>
        <div>登录成功之后，这里就可以换成真实的图表组件。</div>
      </div>

      <div class="badge">支持 JWT 登录态 · Flask + MySQL</div>
    </div>

    <!-- 右侧表单 -->
    <div class="right">
      <div class="tabs">
        <button class="tab active" id="tab-login" onclick="switchMode('login')">登录</button>
        <button class="tab" id="tab-register" onclick="switchMode('register')">注册新账号</button>
      </div>

      <div id="form-login">
        <div class="form-title">欢迎回来</div>
        <div class="form-desc">使用你注册时填写的邮箱和密码登录，获取访问令牌。</div>

        <div class="form-group">
          <label class="form-label" for="login_email">邮箱</label>
          <input class="input" id="login_email" type="email" placeholder="例如：jack@test.com">
        </div>

        <div class="form-group">
          <label class="form-label" for="login_password">密码</label>
          <input class="input" id="login_password" type="password" placeholder="不少于 6 位">
        </div>

        <button class="btn" onclick="login()">登录</button>

        <div class="meta-row">
          <div>还没有账号？<span class="meta-highlight" onclick="switchMode('register')">点这里去注册</span></div>
          <div>本页仅作为 API 调试和演示使用</div>
        </div>
      </div>

      <div id="form-register" style="display:none;">
        <div class="form-title">创建新账号</div>
        <div class="form-desc">注册成功后会自动返回一个 JWT token，后续访问都使用这个令牌。</div>

        <div class="form-group">
          <label class="form-label" for="reg_username">用户名</label>
          <input class="input" id="reg_username" placeholder="显示名称，如：Jack">
        </div>

        <div class="form-group">
          <label class="form-label" for="reg_email">邮箱</label>
          <input class="input" id="reg_email" type="email" placeholder="例如：jack@test.com">
        </div>

        <div class="form-group">
          <label class="form-label" for="reg_password">密码</label>
          <input class="input" id="reg_password" type="password" placeholder="不少于 6 位">
        </div>

        <button class="btn" onclick="register()">注册</button>

        <div class="meta-row">
          <div>已经有账号？<span class="meta-highlight" onclick="switchMode('login')">直接登录</span></div>
          <div>同一个邮箱只能注册一次</div>
        </div>
      </div>

      <div class="tag">
        <span class="tag-dot"></span>
        已登录状态下可直接访问：<code>/api/auth/me</code>、<code>/api/charts/overview</code>
      </div>

      <div class="token-note">
        当前 token 状态：<span id="token-status">未保存</span>  
        （这里使用 <code>localStorage</code> 保存，刷新页面仍然有效）
      </div>

      <div id="status" class="status empty">
        请求返回结果会显示在这里，方便你调试后端接口。
      </div>
    </div>
  </div>

  <script>
    let token = null;

    // 初始化时从 localStorage 读 token
    (function initToken() {
      const saved = localStorage.getItem('auth_token');
      if (saved) {
        token = saved;
        document.getElementById('token-status').innerText = '已保存';
      }
    })();

    function switchMode(mode) {
      const loginForm = document.getElementById('form-login');
      const registerForm = document.getElementById('form-register');
      const tabLogin = document.getElementById('tab-login');
      const tabRegister = document.getElementById('tab-register');

      if (mode === 'login') {
        loginForm.style.display = 'block';
        registerForm.style.display = 'none';
        tabLogin.classList.add('active');
        tabRegister.classList.remove('active');
      } else {
        loginForm.style.display = 'none';
        registerForm.style.display = 'block';
        tabLogin.classList.remove('active');
        tabRegister.classList.add('active');
      }

      setStatus('切换到 ' + (mode === 'login' ? '登录' : '注册') + ' 模式。');
    }

    function setStatus(obj) {
      const box = document.getElementById('status');
      box.classList.remove('empty');
      if (typeof obj === 'string') {
        box.textContent = obj;
      } else {
        box.textContent = JSON.stringify(obj, null, 2);
      }
    }

    async function register() {
      const username = document.getElementById('reg_username').value.trim();
      const email = document.getElementById('reg_email').value.trim();
      const password = document.getElementById('reg_password').value;

      if (!username || !email || !password) {
        alert('请输入完整的用户名、邮箱和密码');
        return;
      }

      setStatus('正在注册中...');
      try {
        const resp = await fetch('http://127.0.0.1:5000/api/auth/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, email, password })
        });

        const data = await resp.json();
        setStatus(data);

        if (resp.ok) {
          token = data.token;
          localStorage.setItem('auth_token', token);
          document.getElementById('token-status').innerText = '已保存';
          alert('注册成功，token 已保存，可以直接访问 /api/auth/me');
          switchMode('login');
          document.getElementById('login_email').value = email;
        } else {
          alert('注册失败：' + (data.message || '未知错误'));
        }
      } catch (err) {
        setStatus('请求出错：' + err.message);
      }
    }

    async function login() {
      const email = document.getElementById('login_email').value.trim();
      const password = document.getElementById('login_password').value;

      if (!email || !password) {
        alert('请输入邮箱和密码');
        return;
      }

      setStatus('正在登录中...');
      try {
        const resp = await fetch('http://127.0.0.1:5000/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });

        const data = await resp.json();
        setStatus(data);

        if (resp.ok) {
          token = data.token;
          localStorage.setItem('auth_token', token);
          document.getElementById('token-status').innerText = '已保存';
          alert('登录成功，token 已保存，可以调用受保护接口了');
          // 登录后自动测试 /me 一次
          getMe(true);
        } else {
          alert('登录失败：' + (data.message || '未知错误'));
        }
      } catch (err) {
        setStatus('请求出错：' + err.message);
      }
    }

    async function getMe(silent = false) {
      if (!token) {
        alert('当前没有 token，请先登录或注册');
        return;
      }

      if (!silent) {
        setStatus('正在请求 /api/auth/me ...');
      }
      try {
        const resp = await fetch('http://127.0.0.1:5000/api/auth/me', {
          method: 'GET',
          headers: {
            'Authorization': 'Bearer ' + token
          }
        });

        const data = await resp.json();
        setStatus(data);

        if (!resp.ok && !silent) {
          alert('请求失败：' + (data.message || '未知错误'));
        }
      } catch (err) {
        setStatus('请求出错：' + err.message);
      }
    }
  </script>
</body>
</html>
